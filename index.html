<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>BIST PortfÃ¶y Takip</title>
<style>
body{font-family:Arial;background:#0f172a;color:white;padding:15px;}
h1{text-align:center;}
table{width:100%;border-collapse:collapse;}
th,td{padding:10px;text-align:center;border-bottom:1px solid #334155;}
.positive{color:#22c55e;font-weight:bold;}
.negative{color:#ef4444;font-weight:bold;}
</style>
</head>
<body>

<h1>ðŸ“Š PortfÃ¶y Takip</h1>

<div id="totalValue">Toplam DeÄŸer: YÃ¼kleniyor...</div>
<div id="totalProfit">Toplam Kar/Zarar: YÃ¼kleniyor...</div>

<h2>PortfÃ¶y Tablosu</h2>
<table id="portfolioTable">
<thead>
<tr><th>Hisse</th><th>Lot</th><th>GÃ¼ncel Fiyat</th><th>Toplam DeÄŸer</th></tr>
</thead>
<tbody></tbody>
</table>

<h2>GÃ¼nlÃ¼k Log (Sheet)</h2>
<table id="dailyLogTable">
<thead>
<tr><th>Tarih</th><th>Toplam DeÄŸer</th><th>Toplam Kar/Zarar</th></tr>
</thead>
<tbody></tbody>
</table>

<script>
const portfolio = [
  { code:"THYAO", lot:50 },
  { code:"TUPRS", lot:70 },
  { code:"ASELS", lot:50 },
  { code:"ENERY", lot:2544.83 },
  { code:"ALARK", lot:50 },
  { code:"MIATK", lot:100 },
  { code:"PETKM", lot:200 },
  { code:"JANTS", lot:198.31 },
  { code:"FZLGY", lot:204.40 },
  { code:"TABGD", lot:9 },
  { code:"SKTAS", lot:650.19 },
  { code:"IZENR", lot:212.50 },
  { code:"ASUZU", lot:30 },
  { code:"BASGZ", lot:40 },
  { code:"CANTE", lot:1065.96 },
  { code:"AKSEN", lot:25 },
  { code:"PENTA", lot:100 },
  { code:"AVPGY", lot:26 },
  { code:"KLSER", lot:49 },
  { code:"KONTR", lot:135 },
  { code:"LMKDC", lot:36 },
  { code:"ENTRA", lot:85 },
  { code:"TATEN", lot:88 },
  { code:"ENJSA", lot:5 },
  { code:"GIPTA", lot:9 },
  { code:"EKOS", lot:72 },
  { code:"REEDR", lot:69 },
  { code:"HATSN", lot:9 },
  { code:"MHRGY", lot:99 },
  { code:"MEKAG", lot:64 },
  { code:"BORLS", lot:41.49 }
];

async function updatePortfolio() {
  const tbody = document.querySelector("#portfolioTable tbody");
  tbody.innerHTML = "<tr><td colspan='4'>YÃ¼kleniyor...</td></tr>";

  const symbols = portfolio.map(p => p.code).join(",");
  const prices = await fetch(`https://bist-portfoy.vercel.app/api/price?symbols=${symbols}`).then(r=>r.json());

  let totalValue = 0;
  tbody.innerHTML = "";
  portfolio.forEach(stock => {
    const price = prices[stock.code]?.price || 0;
    const value = stock.lot * price;
    totalValue += value;

    tbody.innerHTML += `<tr>
      <td>${stock.code}</td>
      <td>${stock.lot}</td>
      <td>${price.toFixed(2)}</td>
      <td>${value.toFixed(2)}</td>
    </tr>`;
  });

  document.getElementById("totalValue").innerText = "Toplam DeÄŸer: " + totalValue.toFixed(2);
}

async function showDailyLogFromSheet() {
  const tbody = document.querySelector("#dailyLogTable tbody");
  tbody.innerHTML = "<tr><td colspan='3'>YÃ¼kleniyor...</td></tr>";

  try {
    const response = await fetch("https://script.google.com/macros/s/AKfycbxgqbjRiqmI0yQqzuO5IfvqJ3_UGXSbUwYbECrQI1RUL10ksjj_PYBt-MFt9m-yDXgQ/exec");
    const data = await response.json();
    tbody.innerHTML = "";
    data.forEach(row => {
      tbody.innerHTML += `<tr>
        <td>${new Date(row.date).toLocaleDateString("tr-TR")}</td>
        <td>${row.totalValue.toFixed(2)}</td>
        <td>${row.totalProfit.toFixed(2)}</td>
      </tr>`;
    });
  } catch {
    tbody.innerHTML = "<tr><td colspan='3'>YÃ¼klenemedi</td></tr>";
  }
}

// BaÅŸlat
updatePortfolio();
showDailyLogFromSheet();
</script>
</body>
</html>
